
<div class="container">        
    <!-- About Section -->
    <div class="about-main">
        <div class="row">
         <div class="col-lg-6 container">
           <div class=" modal-dialog">
             <div class="modal-content">
               <div class="modal-header">
                 <h5 class="modal-title" id="loanModalLabel">Current loan details</h5>
                 <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
               
               </div>
               <div class="modal-body">
                 <!-- <form action="/loan-application" method="post"> -->
                   <div class="">


                    <% if (credit && credit.length > 0) { %>
      
                     <div class="modalBottom">
                      <div class="mb-3">
                        <label for="loanAmount" class="form-label">Loan Amount</label>
                        <input type="text" class="form-control" id="loanAmount" name="loanAmount" value="K<%=credit[0].loanAmount%>" disabled>
                      </div>
                      <div class="mb-3">
                          <label for="amountReceived" class="form-label">Amount You Received</label>
                          <input type="text" class="form-control" id="amountReceived" name="amountReceived" value="K<%=credit[0].amountReceived%>" disabled>
                      </div>
                      <% if(credit[0].penaltyFee > 0){ %>
                        <hr>
                        <p><i>Please repay your loan to reduce extra charges. </i>ðŸ˜’</p>
                        <div class="mb-3">
                          <label for="repaymentAmount" class="form-label" style="color: crimson; text-decoration: line-through;">Repayment Amount</label>
                          <input type="text" class="form-control" id="repaymentAmount" name="repaymentAmount" style="color: crimson; text-decoration: line-through;" value="K<%=credit[0].repaymentAmount%>" disabled>
                        </div>
                        <div class="mb-3">
                          <label for="nextPaymentDate" class="form-label" style="color: crimson; text-decoration: line-through;">Repayment Date</label>
                          <input type="date" class="form-control" id="nextPaymentDate" name="nextPaymentDate" style="color: crimson; text-decoration: line-through;" value="<%=credit[0].nextPaymentDate%>" disabled>
                        </div>
                        <div class="mb-3">
                          <label for="repaymentAmount" class="form-label">Penalty Charge:</label>
                          <input type="text" class="form-control" id="repaymentAmount" name="repaymentAmount" value="K<%=Math.round(credit[0].penaltyFee)%>" disabled>
                        </div>
                        <div class="mb-3">
                          <label for="nextPaymentDate" class="form-label">New Repayment Amount:</label>
                          <input type="text" class="form-control" id="nextPaymentDate" name="nextPaymentDate" value="K<%=credit[0].repaymentAmount - credit[0].penaltyFee %>" disabled>
                        </div>
                        <hr>
                      <% }else{ %>
                        <div class="mb-3">
                          <label for="repaymentAmount" class="form-label">Repayment Amount</label>
                          <input type="text" class="form-control" id="repaymentAmount" name="repaymentAmount" value="K<%=credit[0].repaymentAmount%>" disabled>
                        </div>
                        <div class="mb-3">
                          <label for="nextPaymentDate" class="form-label d-flex flex-column">Repayment Date <i style="font-size: xx-small; color: blue;">(<%=Math.round((credit[0].penaltyFee) / (credit[0].loanAmount * 0.01)).toFixed(0)%> days left)</i></label>
                          <input type="text" class="form-control" id="nextPaymentDate" name="nextPaymentDate" value="<%=credit[0].nextPaymentDate%>" disabled>
                        </div>
                      <% } %>
                      
                      <div class="mb-3">
                          <label for="period" class="form-label">Tenure</label>
                          <input type="text" class="form-control" id="period" name="period" value="<%=credit[0].loanTerm%> <%= credit[0].loanTerm === 1 ? 'week' : 'weeks' %>" disabled>
                      </div>
                      <div class="mb-3">
                        <label for="createdAt" class="form-label">Date Disbursed</label>
                          <input type="text" class="form-control" id="createdAt" name="createdAt" value="<%=credit[0].createdAt.toLocaleDateString('en-GB')%>" disabled>
                      </div>
                      <div class="mb-3">
                        <label for="isPaid" class="form-label">Status</label>
                        <input type="text" class="form-control" id="isPaid" name="isPaid" value="<%= credit[0].isPaid === true ? 'paid' : 'unpaid' %>" disabled>
                      </div>
                        <hr>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#paymentModal">MAKE PAYMENT</button>
                    <div class="modal" id="paymentModal" tabindex="-1"  aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog ">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="paymentModal">Mobile wallet</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                <form action="/credit/repayment" method="post">

                                  <span>click number to proceed</span><br>
                                  <input type="text" class="form-control" id="newMMnumber" name="newMMnumber" value="<%=user.phoneNumber%>"  required hidden>
                                  <button type="submit" class="btn btn-primary btn-icon" id="dashboardButton">
                                    <%=user.phoneNumber%>
                                  </button>
                                </form>
                              <hr>
                                <p>or</p>
                                <hr>

                                <form action="/credit/repayment" method="post">
                                  <div class="mb-2">
                                    <label for="newMMnumber" class="form-label">user different number</label>
                                    <input type="text" class="form-control" id="newMMnumber" name="newMMnumber" placeholder="enter phone number" required>
                                </div>
                                <button type="submit" class="btn btn-primary">submit</button>
                                </form>

                              </div>
                            
                          </div>
                      </div>
                    </div>
                   
                     </div>

                  <% } else { %>
                         <div class="">
                            <p>you're loan free</p>
                            
                            <button type="button" class="btn btn-primary btn-icon" id="dashboardButton">
                              <a href="/credit"><i class="fas fa-money-bill-wave"></i> get a Loan</a> 
                          </button>
                          
                         </div>
                  <% } %>
                  
                  
                  </div>
                 <!-- </form> -->
               </div>
              
             </div>
           </div>
         </div>
         
         <br>
         <br>
         <% if (repayedLoan && repayedLoan.length > 0) { %>
         <div class="col-lg-6 transactionSection">
            <h5>Trasactions</h5>
            
              <% let num = 0 %>
              <ul>
              <% repayedLoan.forEach(function(loan) { %>
                  <li id="transactionDropdownBlog" data-toggle="modal" data-target="#transact<%=num%>">
                    <div class="transactionItem">
                      <span>K<%=loan.loanAmount%></span>
                      <span><%= loan.createdAt.toLocaleDateString('en-GB') %></span>
                    </div>
                  </li>
                  <div class="modal fade" id="transact<%=num%>" tabindex="-1" role="dialog"  aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog " role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" id="exampleModalLabel"><%= loan.createdAt.toLocaleDateString('en-GB') %> <i><%= loan.createdAt.toLocaleTimeString('en-GB') %></i></h6>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">

                              <p>Loan Amount: <span><strong>K<%=loan.loanAmount%></strong></span></p>
                              <p>Amount you received: <span><strong>K<%=loan.amountReceived%></strong></span></p>
                              <p>Amount payed: <span><strong>K<%=loan.repaymentAmount%></strong></span></p>
                              <p>Date payed: <span><strong><%=loan.nextPaymentDate%></strong></span></p>
                              <p>Status: <span><strong><%= loan.isPaid === true ? 'paid' : 'unpaid' %></strong></span></p>

                            </div>

                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          </div>
                          
                        </div>
                    </div>
                  </div>
                  <br>
                  <% num++ %>
                  <%})%>
                </ul>
                 
                  </div>
                  <% } %>             
          
        </div>
        <!-- /.row -->

    </div>
 </div>	




 


 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
   $(document).ready(function() {
    $("#openModal").click(function() {
        $("#myModal").fadeIn();
    });

    $("#closeModal").click(function() {
        $("#myModal").fadeOut();
    });
});

    </script>