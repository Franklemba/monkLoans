<div class="container">        
    <!-- About Section -->
    <div class="about-main">
        <div class="row">
         <div class="col-lg-6">
           <h2>Borrow</h2>
           <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
           <!-- <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p> -->
           <button type="button" class="btn btn-primary btn-icon" id="dashboardButton">
            <a href="/credit/dashboard"><i class="fas fa-tachometer-alt"></i> DASHBOARD</a> 
          </button>
          
          <br>
          <br>
        </div>
         <div class="col-lg-6  container">
           <div class="modal-dialog ">
             <form action="/credit/page" method="post">
            
             <div class="modal-content" id="loan">
              
               <div class="modal-header">
                 <h5 class="modal-title" id="loanModalLabel">Get a Loan Upto K500</h5>
               </div>
               <div class="modal-body">
                   <div class="mb-3">
                     <label for="loanAmount" class="form-label">How much would you like?</label>
                     <input type="number" class="form-control" id="loanAmount" name="loanAmount" value="200" min="100" max="500">
                   </div>
                   <div class="mb-3">
                     <label for="loanTerm" class="form-label">Tenure (weeks):</label>
                     <select name="loanTerm" id="loanTerm">
                        <option value="1">1 week</option>
                        <option value="2">2 weeks</option>
                        <option value="3">3 weeks</option>
                        <option value="4">4 weeks</option>
                     </select>
                   </div>
                   
                   <hr>
 
                   <div class="modalBottom">
                       
                   <div class="mb-3">
                     <label for="serviceFee" class="form-label">Service Fee</label>
                     <input type="text" class="form-control" id="serviceFee" name="serviceFee" value="K5.00" disabled>
                   </div>
                   <div class="mb-3">
                     <label for="amountReceived" class="form-label">Amount You Receive</label>
                     <input type="text" class="form-control" id="amountReceived" name="amountReceived" value="K495.00" disabled>
                   </div>
                   <div class="mb-3">
                     <label for="repaymentAmount" class="form-label">Repayment</label>
                     <input type="text" class="form-control" id="repaymentAmount" name="repaymentAmount" value="K580.00" disabled>
                   </div>
                   <div class="mb-3">
                     <label for="nextPaymentDate" class="form-label">Next Payment Date</label>
                     <input type="date" class="form-control" id="nextPaymentDate" name="nextPaymentDate" value="2023-10-31" disabled>
                   </div>
                   <hr>
                    
                    <button type="button" class="btn btn-primary" id="nextbtn">NEXT</button>
                   
                  </div>
                 <!-- </form> -->
               </div>
               
             </div>

             <div class="modal-content" id="collateralDetails">
              <div class="modal-header">
                <h5 class="modal-title" id="loanModalLabel"><span class="fas fa-cog" id="backBtn"></span> Details</h5>
                <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
              </div>
              <div class="modal-body">
                <!-- <form action="/credit/card" method="post"> -->
                 <!-- <hr> -->
                 <div class="mb-3">
                   <label for="cardholderName">Location</label>
                   <select name="residence" id="locationSelector">
                       <option value="campus">Campus</option>
                       <option value="bh">Boarding house</option>
                   </select>
               </div>
                      
                   <div class="campus mb-3">
                     <label for="roomNumber">Room Number</label>
                     <input type="text" id="roomNumber" name="campusLocation" placeholder="e.g nmh201" required>
                 </div>
             
                 <div class="bh mb-3">
                     <label for="bhLocation">Boarding house location</label>
                     <textarea name="bhLocation" id="bhLocation" placeholder="e.g. kopa street, along bla bla, plot No. 2310, room number 5, etc." required></textarea>
                 </div>

                  <div class="mb-3">
                   <label for="roomMatePhoneNumber">Roommate phone number</label>
                   <input type="text" id="roomMatePhoneNumber" name="roomMatePhoneNumber" required>
                  </div>
                  <div class="mb-3">
                   <label for="collateralItem">Collateral Item Description</label>
                   <textarea name="collateralItem" id="" placeholder="e.g. iphone 6, 32gb storage, black color, etc."></textarea>
                  </div>
                  <div class="mb-3">
                   <label for="otherPhoneNumber">Other phone number(Optional)</label>
                   <input type="text" id="otherPhoneNumber" name="otherPhoneNumber" >
                  </div>
                  
                  <hr>

                  <button type="submit" class="btn btn-primary">APPLY</button>

                  
                </div>
                
              </div>

            </form>
             
           </div>
         </div>
        </div>
        <!-- /.row -->


        <br>
        <br>
        <div class="row">
            <div class="col-lg-6">
              <h5>Our Regulations</h5>
              <ul>
                 <li>Phasellus quis erat et enim laoreet posuere ac porttitor ipsum.</li>
                 <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>                     
                 <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
                 
              </ul>
           </div>
           <div class="col-lg-6">
            <h5>Requirements</h5>
            <ul>
               <li>Phasellus quis erat et enim laoreet posuere ac porttitor ipsum.</li>
               <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>                     
               <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
            </ul>
         </div>
             
           </div>
    </div>
 </div>	




 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    // Define interest rates for different loan terms
    const interestRates = {
      1: 0.1, // 5% for a 1-week term
      2: 0.15, // 6% for a 2-week term
      3: 0.2, // 7% for a 3-week term
      4: 0.25, // 8% for a 4-week term
    };

    // Function to calculate the repayment amount
    function calculateRepayment() {
      const loanAmount = parseFloat($("#loanAmount").val());
      const loanTerm = parseInt($("#loanTerm").val());

      var delayTimer;

    $("#loanAmount").on("input", function() {
      clearTimeout(delayTimer); // Clear the previous timer (if any)
      var inputValue = parseInt($(this).val(), 10);

      // Define the delay (in milliseconds) before applying the change
      var delay = 600; // Adjust this value as needed

      delayTimer = setTimeout(function() {
        if (inputValue < 100) {
          $("#loanAmount").val(100);
        } else if (inputValue > 500) {
          $("#loanAmount").val(500);
        }
      }, delay);
    });
    
      if (!isNaN(loanAmount) && !isNaN(loanTerm)) {
        // Calculate interest based on selected loan term
        const interestRate = interestRates[loanTerm];
        
        // Calculate service fee (assuming a fixed fee of K5.00)
        const serviceFee = 5;
        
        // Calculate total repayment amount
        const interestAmount = loanAmount * interestRate;
        const totalRepayment = loanAmount + interestAmount + serviceFee;
        
        // Display calculated values
        $("#serviceFee").val(`K${serviceFee.toFixed(2)}`);
        $("#amountReceived").val(`K${(loanAmount - serviceFee).toFixed(2)}`);
        $("#repaymentAmount").val(`K${totalRepayment.toFixed(2)}`);
        
        // Calculate and display next payment date (assuming 7 days per week)
        const today = new Date();
        const nextPaymentDate = new Date(today.getTime() + loanTerm * 7 * 24 * 60 * 60 * 1000);
        const formattedDate = nextPaymentDate.toISOString().substr(0, 10);
        $("#nextPaymentDate").val(formattedDate);
      }
    }

    // Add an event listener to the loanAmount and loanTerm inputs
    $("#loanAmount").on("input", calculateRepayment);
    $("#loanTerm").on("input", calculateRepayment);
    $("#loanType").on("change", calculateRepayment);

    // Calculate repayment on page load
    calculateRepayment();


    
    $("#collateralDetails").hide();
   
   // Handle nextBtn click event
   $("#nextbtn").click(function () {
     // Fade out senderData div
     $("#loan").fadeOut("slow", function () {
       // Once fadeOut is complete, fade in#collateralDetails div
       $("#collateralDetails").fadeIn("slow");
     });

   });

   $("#backBtn").click(function(){
     $('.error-message').remove();
     $("#collateralDetails").fadeOut("slow", function () {
       // Once fadeOut is complete, fade in#collateralDetails div
       $("#loan").fadeIn("slow");
     });
   })



   updateVisibilityAndRequired();

// Attach an event handler to the location selector
$('#locationSelector').on('change', function() {
    updateVisibilityAndRequired();
});

// Function to update the visibility and required attribute based on the selection
function updateVisibilityAndRequired() {
    var selectedLocation = $('#locationSelector').val();

    if (selectedLocation === 'campus') {
        $('.campus').show().find('input').prop('required', true);
        $('.bh').hide().find('textarea').prop('required', false);
    } else if (selectedLocation === 'bh') {
        $('.campus').hide().find('input').prop('required', false);
        $('.bh').show().find('textarea').prop('required', true);
    }
}


  });
</script>